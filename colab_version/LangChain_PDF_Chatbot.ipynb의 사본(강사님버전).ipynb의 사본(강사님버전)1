{"cells":[{"cell_type":"markdown","metadata":{"id":"0KKqwrxa5EsI"},"source":["该Python notebook利用langchain的QA chain，结合Chroma来实现PDF文档Analysis-and-Comparison-between-Optimism-and-StarkNet.pdf的语义化搜索。\n","\n","该PDF文档共61页。通过本notebook，我们演示该字数规模的文件的语义化索引的OpenAI API开销。\n","\n","使用时，在本地创建`.env`，并如`.env.example`所示，设置有效的OpenAI API Key即可。"]},{"cell_type":"code","execution_count":6,"metadata":{"id":"Nifwi9FrKb3g","executionInfo":{"status":"ok","timestamp":1703739552506,"user_tz":-540,"elapsed":24050,"user":{"displayName":"김규미","userId":"17000887428504010317"}}},"outputs":[],"source":["%pip install openai > /dev/null\n","%pip install chromadb > /dev/null\n","%pip install langchain > /dev/null"]},{"cell_type":"code","source":["!pip install tiktoken"],"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"rQcUbL7m70kn","executionInfo":{"status":"ok","timestamp":1703741980084,"user_tz":-540,"elapsed":8336,"user":{"displayName":"김규미","userId":"17000887428504010317"}},"outputId":"c3b53f28-83ae-4180-e977-a8d1055d0096"},"execution_count":66,"outputs":[{"output_type":"stream","name":"stdout","text":["Collecting tiktoken\n","  Downloading tiktoken-0.5.2-cp310-cp310-manylinux_2_17_x86_64.manylinux2014_x86_64.whl (2.0 MB)\n","\u001b[2K     \u001b[90m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\u001b[0m \u001b[32m2.0/2.0 MB\u001b[0m \u001b[31m8.6 MB/s\u001b[0m eta \u001b[36m0:00:00\u001b[0m\n","\u001b[?25hRequirement already satisfied: regex>=2022.1.18 in /usr/local/lib/python3.10/dist-packages (from tiktoken) (2023.6.3)\n","Requirement already satisfied: requests>=2.26.0 in /usr/local/lib/python3.10/dist-packages (from tiktoken) (2.31.0)\n","Requirement already satisfied: charset-normalizer<4,>=2 in /usr/local/lib/python3.10/dist-packages (from requests>=2.26.0->tiktoken) (3.3.2)\n","Requirement already satisfied: idna<4,>=2.5 in /usr/local/lib/python3.10/dist-packages (from requests>=2.26.0->tiktoken) (3.6)\n","Requirement already satisfied: urllib3<3,>=1.21.1 in /usr/local/lib/python3.10/dist-packages (from requests>=2.26.0->tiktoken) (1.26.18)\n","Requirement already satisfied: certifi>=2017.4.17 in /usr/local/lib/python3.10/dist-packages (from requests>=2.26.0->tiktoken) (2023.11.17)\n","Installing collected packages: tiktoken\n","\u001b[31mERROR: pip's dependency resolver does not currently take into account all the packages that are installed. This behaviour is the source of the following dependency conflicts.\n","llmx 0.0.15a0 requires cohere, which is not installed.\u001b[0m\u001b[31m\n","\u001b[0mSuccessfully installed tiktoken-0.5.2\n"]}]},{"cell_type":"code","execution_count":7,"metadata":{"id":"5xgbUBve0LuN","executionInfo":{"status":"ok","timestamp":1703739556267,"user_tz":-540,"elapsed":313,"user":{"displayName":"김규미","userId":"17000887428504010317"}}},"outputs":[],"source":[]},{"cell_type":"code","execution_count":99,"metadata":{"id":"UpOBdhBrdaiU","executionInfo":{"status":"ok","timestamp":1703745608420,"user_tz":-540,"elapsed":3,"user":{"displayName":"김규미","userId":"17000887428504010317"}}},"outputs":[],"source":["PDF_NAME='/content/drive/MyDrive/63_73_OCR_compressed.pdf'"]},{"cell_type":"code","source":["# PyMuPDFLoader (X) 한글 안됨\n","# from langchain.document_loaders import PyMuPDFLoader\n","\n","# def load_pdf():\n","#   return PyMuPDFLoader(PDF_NAME).load()"],"metadata":{"id":"PqD2amox5EJW"},"execution_count":null,"outputs":[]},{"cell_type":"code","source":["!pip install pypdf"],"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"ZpqbAq424s1u","executionInfo":{"status":"ok","timestamp":1703741161729,"user_tz":-540,"elapsed":10245,"user":{"displayName":"김규미","userId":"17000887428504010317"}},"outputId":"1f01262e-a9f9-49ee-ab6a-381df2fef184"},"execution_count":46,"outputs":[{"output_type":"stream","name":"stdout","text":["Collecting pypdf\n","  Downloading pypdf-3.17.4-py3-none-any.whl (278 kB)\n","\u001b[?25l     \u001b[90m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\u001b[0m \u001b[32m0.0/278.2 kB\u001b[0m \u001b[31m?\u001b[0m eta \u001b[36m-:--:--\u001b[0m\r\u001b[2K     \u001b[91m━━━━━━━━━━━━━━━━━\u001b[0m\u001b[91m╸\u001b[0m\u001b[90m━━━━━━━━━━━━━━━━━━━━━━\u001b[0m \u001b[32m122.9/278.2 kB\u001b[0m \u001b[31m3.4 MB/s\u001b[0m eta \u001b[36m0:00:01\u001b[0m\r\u001b[2K     \u001b[90m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\u001b[0m \u001b[32m278.2/278.2 kB\u001b[0m \u001b[31m4.3 MB/s\u001b[0m eta \u001b[36m0:00:00\u001b[0m\n","\u001b[?25hInstalling collected packages: pypdf\n","Successfully installed pypdf-3.17.4\n"]}]},{"cell_type":"code","source":["\n","from langchain.document_loaders import PyPDFLoader\n","\n","loader = PyPDFLoader(PDF_NAME)\n","docs = loader.load_and_split()\n","docs"],"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"HUbuPtug4odO","executionInfo":{"status":"ok","timestamp":1703745632465,"user_tz":-540,"elapsed":877,"user":{"displayName":"김규미","userId":"17000887428504010317"}},"outputId":"ac835867-f78e-4ac8-899f-d04f3be297ab"},"execution_count":101,"outputs":[{"output_type":"execute_result","data":{"text/plain":["[Document(page_content='않았다\\n다음 장날에 선자는 중개상 사무실 앞에 사업가 무리와 서 있 \\n는 한수를 발견하고 한수의 눈에 띌 때까지 기다렸다 선자가 한 \\n수에게 고개를 숙여 인사했다 한수는 살짝 고개를 까딱하고 나 \\n서 하던 일을 계속했다 선자가 장을 마저 다 보고 나룻배를 타러 \\n갈 때 한수가 선자를 따라잡았다\\n“시간좀 있어?” 한수가 물었다\\n선자의 눈이 커졌다 무슨 뜻일까?\\n\"이야기할 시간.”\\n선자는 평생 남자들 틈에서 살았다 한 번도 남자들을 무서워 \\n하거나 남자들 앞에서 어색했던 적이 없었다 하지만 한수와 있으 \\n면 아무 말도 떠오르지 않았다 곁에 서 있는 것조차 힘들었다. 선 \\n자는 침을 삼키고 하숙인들을 대할 때처럼 말하기로 마음먹었다 \\n선자는 열여섯 살이나 먹었고，겁에 질린 아이가 아니었다\\n“저번에 도와주셔서 감사했어예. ”\\n“별거 아니야. ”\\n“진작에 말씀드렸어야 했어예.  고맙십니더. ”\\n“너랑 이야기를 하고 싶은데.  여기서 말고.”\\n“어디서예?” 선자는 왜냐고 물었어야 했다고 뒤늦게 생각했다\\n“너희 집 뒤쪽 바닷가로 갈게. 물이 얕은 쪽 커다란 검은 바위 \\n근처로. 너 거기서 빨래하잖아.” 한수는 선자의 일상을 조금 알고 \\n있다고 알리고 싶었다 “혼자 올 수 있어?”\\n선자는 장바구니들을 내려다보았다 뭐라고 말해야 할지 모르\\n63', metadata={'source': '/content/drive/MyDrive/63_73_OCR_compressed.pdf', 'page': 0}),\n"," Document(page_content='겠지만 한수와 조금 더 이야기를 하고 싶었다. 하지만 어머니가 \\n절대로 허락하지 않을 터였다\\n“내일 아침에 빠져나올 수 있어? 이맘때쯤에?”\\n“모르겠어예. ”\\n“오후가 더 낫나?”\\n“울 집 사내들이 일 마치고 온 후가 좋을 거 같아예.” 저도 모르 \\n게 말이 나왔고 목소리가 점점 잦아들었다\\n한수는 검은 바위 옆에서 신문을 읽으면서 선자를 기다리고 \\n있었다. 선자의 기억보다 바다가 더 파랬고，길쭉하고 얄따란 구 \\n름은 더 하얬다 한수가 여기 있으니 모든 것이 더 생생해 보였다 \\n신문 귀퉁이가 산들바람에 펄럭였다. 한수는 귀퉁이를 꽉 쥐었다 \\n가 다가오는 선자가 보이자 신문을 접어 옆구리에 끼었다 한수는 \\n선자 쪽으로 가지 않고 선자가 올 때까지 기다렸다. 선자가 더러 \\n운 빨랫감이 든 커다란 보따리를 머리에 이고 흔들림 없이 걸어 \\n왔다\\n“선생님.” 선자가 두려운 기색을 드러내지 않으려고 애쓰며 말 \\n했다. 고개 숙여 인사할 수가 없어서 보따리로 손을 올려 잡았지 \\n만，한수가 재빨리 손을 뻗어 선자의 머리에서 보따리를 들어올 \\n렸다 한수가 빨랫감 보따리를 물기 없는 바위에 내려놓는 사이 \\n에 선자가 등을 바르게 폈다\\n“선생님,  고맙십니더. ”\\n“오빠라고 불러. 넌 오빠가 없고 난 여동생이 없으니 네가 내 여\\n64', metadata={'source': '/content/drive/MyDrive/63_73_OCR_compressed.pdf', 'page': 1}),\n"," Document(page_content='동생 하면 되겠다. ”\\n선자는 아무 말도 하지 않았다\\n“여기 좋네.” 한수의 눈이 바다 한가운데서 이는 낮은 파도를 \\n물끄러미 바라보다가 수평선에 머물렀다. “제주만큼 아름답지는 \\n않아도 느낌이 비슷해. 너랑 난 둘 다 섬 출신이네. 언젠가 너도 \\n섬사람은 좀 다르다는 걸 알게 될 거야. 우린 더 자유롭지. ”\\n선자는 한수의 목소리가 좋았다 남자답고 확신에 차 있지만 \\n쓸쓸한 기색이 서려 있는 목소리였다\\n“넌 평생을 여기서 보내겠지. ”\\n“예，고향이니까예. ” 선자가 말했다\\n“고향이라.” 한수가 생각에 잠겨 말했다 “우리 아버지는 제주에 \\n서 귤 농사를 지었어. 내가 열두 살 때 아버지와 오사카로 갔지. \\n난 제주를 고향으로 생각하지 않아 우리 어머니는 내가 아주 어 \\n렸을 때 돌아가셨어.” 한수는 선자가 자기 외가 쪽 누군가를 닮았 \\n다는 말을 그때는 하지 않았다 눈과 훤한 이마가 그랬다\\n“빨랫감이 상당히 많네. 예전에 아버지랑 내 옷을 내가 빨았어. \\n딱 질색이었자 부자가 돼서 제일 좋은 건 빨래와 밥을 해줄 사람 \\n이 있다는거야”\\n선자는 걸음마를 익힌 후부터 쭉 빨래를 한 것이나 마찬가지였 \\n다 빨래가 딱히 싫지는 않았다 그보다는 다림질이 더 어려웠다\\n“빨래할 때 무슨 생각해?”\\n한수는 선자에 대해 알아야 할 것은 이미 알고 있었지만 이 여 \\n자아이가 무슨 생각을 하는지도 알고 싶었다 한수는 누군가의 \\n65', metadata={'source': '/content/drive/MyDrive/63_73_OCR_compressed.pdf', 'page': 2}),\n"," Document(page_content='마음을 알고 싶을 때 질문을 많이 했다 대부분의 사람은 자기 생 \\n각을 말로 하고 난 후에 행동으로 확인시켜주었다 거짓말을 하 \\n는 사람보다 진실을 말하는 사람이 훨씬 많았다. 거짓말을 잘하 \\n는 사람은 아주 드물었다. 오히려 한수는 어떤 사람이 알고 보니 \\n남들과 별다를 바 없음을 알았을 때 가장 실망스러웠다 한수는 \\n멍청한 여자보다 똑똑한 여자를 좋아했고，드러누울 줄만 아는 \\n게으른 여자보다 열심히 일하는 여자를 좋아했다\\n“내가 어렸을 때 아버지나 나나 옷이 한 벌밖에 없었어. 그래서 \\n빨래를 하고 나면，아버지랑 내가 어떻게든 밤새 옷을 말리려고 \\n했는데 잘 안 말라서 아침에 축축한 옷을 입었지. 한번은，내가 \\n열 살인가 열한 살인가 그랬을 거야 옷을 빨리 말리려고 난로 옆 \\n에 두고 저녁밥을 하러 갔어. 보리죽을 쑤어 먹었는데，싸구려 냄 \\n비라 내내 저어주어야 했어. 안 그러면 냄비 바닥이 타버렸거든. \\n그래서 보리죽을 젓고 있는데 고약한 냄새가 나더라고. 나중에 보 \\n니까 아버지 윗도리 소매가 타서 커다란 구멍이 난 거야 그래서 \\n아버지한테 호되게 야단맞았어.” 한수가 아버지한테 매 맞은 기억 \\n을 떠올리며 소리 내어 웃었다\\n“정신 나간 놈 같으니라고! 아들이라고 하나 있는 게 쓸모없는 \\n멍청이야!” 버는 족족 술에 탕진한 한수의 아버지는 식구를 잘 건 \\n사하지 못했다는 데 자책을 느끼지 않았다 되려 나물을 캐고 사 \\n냥을 하거나 좀도둑질을 해서라도 식구를 먹여 살리려는 아들한 \\n테 모질게 굴었다\\n선자는 고한수 같은 사람이 자기 옷을 직접 빠는 것을 상상하 \\n66', metadata={'source': '/content/drive/MyDrive/63_73_OCR_compressed.pdf', 'page': 3}),\n"," Document(page_content='기 어려웠다 한수의 옷은 아주 고급이었고 몸에 잘 맞게 재단되 \\n어 있었다. 선자는 한수가 매번 다른 하얀 정장과 하얀 구두 차림 \\n인 모습을 이미 보았다 한수처럼 옷을 입는 사람은 없었다\\n선자는 할 말을 찾아냈다\\n“저는 빨래할 때 빨래를 잘할 생각을 합니더. 빨래는 제가 좋아 \\n하는 일 중 하나라예. 제가 옷을 더 좋게 할 수 있으니까예. 깨지 \\n면 내버려야 하는 항아리랑 다르다 아닙니꺼. ”\\n한수가 선자를 보며 빙긋이 웃었다 “오래전부터 너랑 함께 있 \\n고 싶었어. ”\\n또다시 선자는 왜냐고 물어보고 싶었지만 이제는 아무래도 상 \\n관없었다\\n“네 얼굴은 참 선해.” 한수가 말했다 “정직해 보여.”\\n시장 아주머니들도 전에 선자에게 그런 말을 했다 선자는 흥정 \\n을 잘하지 못했고 그럴 시도도 하지 않았다 하지만 오늘 아침에 \\n선자는 고한수를 만나기로 했다는 말을 엄마에게 하지 않았다 \\n저를 괴롭힌 일본인 학생들 이야기조차 하지 않았다. 어젯밤에 선 \\n자는 평소 함께 빨래를 하는 덕희에게 혼자서 하겠다고 말했다 \\n덕희는 빨래를 안 해도 되니 아주 좋아했다\\n“좋아하는 사람 있어?” 한수가 물었다\\n선자의 볼이 발그레 물들었다 “아니예. ”\\n한수가 방긋 웃었다. “넌 이제 열일곱 살이 되잖아. 난 서른넷이 \\n야 네 나이의 딱 두 배자 오빠이자 친구가 돼줄게. 한수 오빠 마 \\n음에 들어?”', metadata={'source': '/content/drive/MyDrive/63_73_OCR_compressed.pdf', 'page': 4}),\n"," Document(page_content='선자는 한수의 검은 눈동자를 바라보면서，아버지의 병이 낫기 \\n를 바라던 때를 빼면 무언가를 이보다 간절히 바란 적이 없었다 \\n고 생각했다. 선자가 아버지를 생각하지 않거나 머릿속에서 아버 \\n지 목소리를 듣지 않은 날은 하루도 없었다.\\n“빨래는 언제 해?”\\n“사흘에 한번씩예. ”\\n“이 시간에?”\\n선자가 고개를 끄덕였다. 선자는 깊게 숨을 들이마셨고，기대감 \\n과 경이감이 폐와 심장에 가득 차올랐다. 선자는 이 바닷가를 아 \\n주 좋아했다 끝없이 펼쳐지는 열은 청록색 바다 돌투성이 모래 \\n와 바다 사이의 검은 바위，그 가장자리를 죽 둘러싼 자그마한 하 \\n얀 조약돌. 고요한 이곳에 있으면 안전하고 충만하다고 느꼈다 여 \\n기에 오는 사람은 거의 없었지만，이제 이곳이 예전과 다르게 보 \\n일 것 같았다\\n한수가 선자의 발 옆에서 매끄럽고 납작한 돌멩이를 주웠다 가 \\n는 회색 줄무늬가 있는 검은 돌멩이였다 한수는 도매용 생선 상 \\n자에 표시할 때 쓰는 하얀 분필을 주머니에서 꺼내 돌멩이 뒷면 \\n에 가위표를 그렸다 한수는 쭈그리고 앉아 두 사람을 둘러싸고 \\n있는 거대한 바위들을 손으로 더듬거리다가，의자 높이만 한 중간 \\n크기의 바위에서 물기 없는 틈을 발견했다\\n“내가 여기 왔다가 네가 아직 오기 전에 일하러 돌아가야 할 수 \\n도 있잖아 그럼 이 돌멩이를 여기 바위틈에 끼워놓을게. 내가 왔 \\n다 간 걸 네가 알 수 있게. 네가 여기 왔는데 내가 없으면 이 돌멩 \\n68', metadata={'source': '/content/drive/MyDrive/63_73_OCR_compressed.pdf', 'page': 5}),\n"," Document(page_content='이를 같은 곳에 둬. 네가 날 만나러 왔다는 걸 내가 알 수 있게.”\\n한수가 선자의 팔을 토닥이고 나서 빙그레 웃었다\\n“선자야 이제 가야겠어.  나중에 보자，알았지?”\\n선자는 멀어지는 한수를 지켜보다가 한수가 시야에서 사라지자 \\n마자 쪼그리고 앉아 빨래를 시작하려고 보따리를 풀었다 선자는 \\n더러운 윗도리를 꺼내 차가운 물에 담갔다 모든 것이 달라졌다\\n사흘 후，선자는 한수를 만났다 빨래를 도맡아 하겠노라고 식 \\n모 자매를 설득하기는 쉬웠다 이번에도 한수는 바위 옆에서 신 \\n문을 읽으면서 기다리고 있었다 검은 띠가 둘러진 옅은 색 모자 \\n를 쓰고 있었다 한수는 세련돼 보였다 선자는 다른 사람에게 들 \\n킬까 봐 무서웠지만，한수는 바위 옆에서 선자를 만나는 것이 평 \\n범한 일인 양 행동했다 선자는 어머니나 복희，덕희 자매에게 한 \\n수에 대해 이야기하지 않아서 죄책감을 느꼈다 한수와 선자는 \\n검은 바위에 앉아 30분 정도 이야기를 나누었고, 한수는 이상한 \\n질문을 했다 “조용히 별일을 안 할 때는 무슨 생각해?”\\n선자가 아무 일도 하지 않을 때는 없었다 하숙집에는 늘 할 일 \\n이 많았다 선자는 어머니가 빈둥거리는 모습을 본 기억이 없었 \\n다. 선자가 항상 바쁘다고 말하고 나서 생각해보니 그렇지도 않 \\n았다 일을 하고 있는데 아무 일도 하지 않는 듯한 느낌이 들 때 \\n도 있었다. 딱히 신경을 쓰지 않고도 할 수 있는 일이기 때문이었 \\n다 생각하지 않고도 감자를 깎거나 방바닥을 닦을 수 있었다 요 \\n즘에는 마음에 여유가 있을 때면 한수 생각을 했는데 이런 말을 \\n69', metadata={'source': '/content/drive/MyDrive/63_73_OCR_compressed.pdf', 'page': 6}),\n"," Document(page_content='할 수는 없는 노릇 아닌가 한수는 돌아가기 직전에 좋은 친구란 \\n무엇이라고 생각하느냐 물었고 선자는 한수가 좋은 친구라고 대 \\n답했다 선자가 곤경에 처했을 때 한수가 도와주어서였다 한수는 \\n그 대답을 듣고 빙그레 웃으며 선자의 머리를 쓰다듬었다 두 사 \\n람은 며칠에 한 번씩 그 바닷가에서 만났다. 선자는 바닷가나 장 \\n에 가서 하는 일을 집에서 눈치채지 못하도록 빨래와 집안일을 \\n갈수록 재빠르게 해치웠다\\n장이나 바닷가에 가려고 부엌 문턱을 넘기 전에 선자는 광을 \\n낸 냄비 뚜껑에 자신을 비춰 보고 그날 아침에 단단하게 맣은 머 \\n리를 매만졌다 선자는 예쁘게 꾸미는 법을 몰랐고 고한수처럼 \\n대단한 남자는 물론이고 여느 남자의 마음에 드는 법도 몰랐다 \\n그래서 매무새라도 깨끗하고 단정히 하려고 애썼다.\\n한수를 만나면 만날수록 선자의 마음속에 한수가 선명하게 새 \\n겨졌다 선자의 머릿속은 이제껏 한 번도 상상해본 적 없는 사람 \\n과 장소가 나오는 한수의 이야기로 가득 찼다 한수는 오사카에 \\n살았다. 오사카는 일본의 큰 항구도시였는데 한수의 말에 따르 \\n면 돈만 있으면 원하는 것을 무엇이든 살 수 있고 거의 모든 집에 \\n전기가 들어오며 겨울에도 따뜻하게 해주는 전기 난방기가 있는 \\n곳이었다. 한수는 도쿄가 경성보다 훨씬 번화하고 사람 상점，식 \\n당，극장이 더 많다고 말했다 만주와 평양에도 가봤다고 했다 한 \\n수는 그 도시들에 대해 생생하게 이야기하면서 언젠가 둘이 같이 \\n가자고 했는데，선자는 그런 일은 일어나지 않을 거라고 생각했 \\n다 그래도 토를 달지는 않았다 한수와 같이 여행한다고 생각하 \\n70', metadata={'source': '/content/drive/MyDrive/63_73_OCR_compressed.pdf', 'page': 7}),\n"," Document(page_content='니 좋아서였다 바닷가에서 한수와 잠시 시간을 보내는 게 아니 \\n라 더 오래 한수와 함께 있을 수 있다는 생각만으로도 좋았다 한 \\n수는 출장을 다녀오면 색이 고운 사탕과 달콤한 비스킷을 사 왔 \\n다 아이를 먹이는 엄마처럼 사탕 껍질을 벗겨 선자의 입에 쏙 넣 \\n어주었다 선자는 그렇게 예쁘고 맛있는 것을 먹어본 적이 없었 \\n다 딱딱한 분홍색 사탕은 미국에서，버터 비스킷은 영국에서 들 \\n여왔다. 선자는 어머니한테 들키지 않으려고 조심스럽게 포장지 \\n를 집 밖에 버렸다.\\n선자는 한수의 이야기와 경험에 빠져들었다. 한수의 경험은 먼 \\n곳에서 온 어부들이나 노동자들이 들려준 모험보다 훨씬 특별했 \\n다 게다가 선자와 한수의 관계에는 새롭고 강렬한 무엇인가가 있 \\n었고 이는 선자가 미처 예상하지 못한 일이었다. 한수를 만나기 \\n전에는 자기 생활에 대해 이야기할 사람이 없었다 하숙인들의 우 \\n스운 습관들，어머니 밑에서 일하는 자매들과 나눈 대화들，아버 \\n지에 대한 기억들，마음속 사소한 궁금증을 터놓을 데가 없었다 \\n이제는 영도와 부산 밖의 세상이 어떻게 돌아가는지 물어볼 사람 \\n이 생겼다 한수는 선자가 하루를 어떻게 보냈는지 듣고 싶어 했 \\n다 선자의 꿈이 무엇인지까지 알고 싶어 했다 가끔 선자가 난처 \\n한 일을 처리하거나 사람을 상대하는 법을 모를 때면 해결책을 \\n알려주었다 늘 한수는 문제를 해결할 묘안을 생각해냈다 두 사 \\n람은 선자의 어머니 이야기는 절대 하지 않았다.\\n장에서 일하고 있는 한수를 보면 낯설었다 선자와 함께 있을 \\n때의 한수와는 다른 사람 같았다 한수는 선자의 친구이자 오빠 \\n71', metadata={'source': '/content/drive/MyDrive/63_73_OCR_compressed.pdf', 'page': 8}),\n"," Document(page_content='였고，선자가 빨래를 이고 다가갈 때마다 빨래 보따리를 들어주 \\n는 사람이었다 “그렇게 걸어오는 모습이 참 단아하구나.” 한수는 \\n이렇게 말하며 곧고 튼튼한 선자의 목을 칭찬했다 한번은 한수 \\n가 두툼하고 넓은 두 손으로 선자의 목덜미를 슬쩍 건드렸고，선 \\n자는 한수의 손길에 놀라 펄쩍 뛰어올랐다 그 자극적인 느낌에 \\n선자는 충격을 받았다.\\n선자는 늘 한수가 보고 싶었다 한수가 또 누구와 이야기를 나 \\n누고 질문을 할까? 선자가 하숙인들의 밥을 차리거나 밥상을 닦 \\n거나 어머니 옆에서 잠드는 밤에 한수는 무엇을 할까? 한수에게 \\n직접 물어볼 수는 없어서 선자는 이런 물음들을 마음속에 담아 \\n두었다\\n두사람은 석 달동안같은 방식으로 만났고 함께 있는 것이 점 \\n점 편해졌다 가을이 오자 바닷바람이 상쾌하고 쌀쌀해졌지만 선 \\n자는 추운 줄도 몰랐다\\n9월 초에 닷새 내내 비가 왔다 마침내 비가 개자 양진이 선자 \\n에게 다음 날 아침에 태종대 숲에 가서 버섯을 따 오라고 시켰다 \\n선자는 버섯 따는 것을 좋아했고，마침 바닷가에서 한수를 만날 \\n참이라 맨날 하는 일이 아닌 색다른 일을 하러 간다고 말할 생각 \\n에 설렜다 한수는 여행을 다니면서 새로운 것을 자주 보았다 선 \\n자는 판에 박힌 생활에서 벗어난 뭔가를 하는 것은 이번이 처음 \\n이었다.\\n잔뜩 신난 선자가 내일 아침밥을 먹고 나서 바로 버섯을 따러 \\n간다는 계획을 불쑥 말했다. 한수가 잠시 아무 말 없이 생각에 잠 \\n72', metadata={'source': '/content/drive/MyDrive/63_73_OCR_compressed.pdf', 'page': 9}),\n"," Document(page_content='긴 눈으로 선자를 빤히 쳐다보았다\\n“이 오빠가 버섯이랑 풀뿌리를 기가 막히게 잘 찾아 먹을 수 있 \\n는 것과 먹을 수 없는 것에 훤하지. 어릴 적에 몇 시간씩 찾으러 \\n다녔거든. 봄에는 고사리를 뜯어서 말렸아 새총으로 토끼를 잡 \\n아서 저녁으로 먹곤 했고. 한번은 해 질 무렵에 꿩 한 쌍을 잡았 \\n어. 참 오랜만에 먹은 고기였어. 아버지가 아주 흐뭇해하셨지!” 한 \\n수의 표정이 부드러워졌다\\n“같이 가면 되겠다 버섯은 언제까지 따면 돼?” 한수가 물었다\\n“오빠도 가고 싶어예?”\\n일주일에 두 번씩 30분 동안 한수와 이야기를 나누는 것과는 \\n다르게 한수와 종일 같이 있는 것은 상상해본 적도 없다 함께 있 \\n는 것을 들키면 어떻게 될까? 선자의 얼굴이 화끈거렸다 어떻게 \\n해야 할까? 애초에 선자가 꺼낸 말이었고，이제 와서 한수에게 오 \\n지 말라고 할 수도 없었다\\n“여기서 만나자 이제 시장으로 돌아가야겠어.” 한수가 이번에는 \\n평소와 다르게 웃었다 들뜬 기색이 역력한 사내아이 같았다\\n“우린 버섯을 무더기로 찾을 거야 틀림없어. ”\\n두 사람은 섬 가장자리를 따라 걸었다 같이 있는 모습이 사람 \\n들의 눈에 띄지 않을 곳이었다 해안선이 평소보다 아름다워 보였 \\n다 두 사람이 섬 반대쪽에 자리 잡은 숲에 가까이 다가가자 나들 \\n이옷을 입은 양 노랗고 빨갛게 물든 커다란 소나무와 단풍나무, \\n전나무가 두 사람을 반갑게 맞이했다 한수가 오사카 생활에 대\\n73', metadata={'source': '/content/drive/MyDrive/63_73_OCR_compressed.pdf', 'page': 10})]"]},"metadata":{},"execution_count":101}]},{"cell_type":"code","source":[],"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"gEZeRTk94yYu","executionInfo":{"status":"ok","timestamp":1703741186464,"user_tz":-540,"elapsed":605,"user":{"displayName":"김규미","userId":"17000887428504010317"}},"outputId":"24ac3f30-356e-40d8-9098-0d98a1042344"},"execution_count":49,"outputs":[{"output_type":"execute_result","data":{"text/plain":["[]"]},"metadata":{},"execution_count":49}]},{"cell_type":"code","source":["from google.colab import drive\n","drive.mount('/content/drive')"],"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"qArsfhA1qIdh","executionInfo":{"status":"ok","timestamp":1703739643046,"user_tz":-540,"elapsed":2554,"user":{"displayName":"김규미","userId":"17000887428504010317"}},"outputId":"998a0d3b-7768-4a68-d2af-b55c304d07eb"},"execution_count":9,"outputs":[{"output_type":"stream","name":"stdout","text":["Drive already mounted at /content/drive; to attempt to forcibly remount, call drive.mount(\"/content/drive\", force_remount=True).\n"]}]},{"cell_type":"code","source":["!pip install pymupdf"],"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"onVIQBv_z3-b","executionInfo":{"status":"ok","timestamp":1703739909162,"user_tz":-540,"elapsed":14146,"user":{"displayName":"김규미","userId":"17000887428504010317"}},"outputId":"f73905a5-87f7-4f73-d4d6-52a362b969e9"},"execution_count":13,"outputs":[{"output_type":"stream","name":"stdout","text":["Collecting pymupdf\n","  Downloading PyMuPDF-1.23.8-cp310-none-manylinux2014_x86_64.whl (4.4 MB)\n","\u001b[2K     \u001b[90m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\u001b[0m \u001b[32m4.4/4.4 MB\u001b[0m \u001b[31m14.1 MB/s\u001b[0m eta \u001b[36m0:00:00\u001b[0m\n","\u001b[?25hCollecting PyMuPDFb==1.23.7 (from pymupdf)\n","  Downloading PyMuPDFb-1.23.7-py3-none-manylinux2014_x86_64.manylinux_2_17_x86_64.whl (30.6 MB)\n","\u001b[2K     \u001b[90m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\u001b[0m \u001b[32m30.6/30.6 MB\u001b[0m \u001b[31m23.6 MB/s\u001b[0m eta \u001b[36m0:00:00\u001b[0m\n","\u001b[?25hInstalling collected packages: PyMuPDFb, pymupdf\n","Successfully installed PyMuPDFb-1.23.7 pymupdf-1.23.8\n"]}]},{"cell_type":"code","source":["docs= load_pdf()"],"metadata":{"colab":{"base_uri":"https://localhost:8080/","height":294},"id":"LFmc0PSs1RLO","executionInfo":{"status":"error","timestamp":1703741095321,"user_tz":-540,"elapsed":330,"user":{"displayName":"김규미","userId":"17000887428504010317"}},"outputId":"f47cbea3-f33e-4ffa-8fd8-b033795c9b31"},"execution_count":44,"outputs":[{"output_type":"error","ename":"NameError","evalue":"ignored","traceback":["\u001b[0;31m---------------------------------------------------------------------------\u001b[0m","\u001b[0;31mNameError\u001b[0m                                 Traceback (most recent call last)","\u001b[0;32m<ipython-input-44-1b6ac641c8cd>\u001b[0m in \u001b[0;36m<cell line: 1>\u001b[0;34m()\u001b[0m\n\u001b[0;32m----> 1\u001b[0;31m \u001b[0mdocs\u001b[0m\u001b[0;34m=\u001b[0m \u001b[0mload_pdf\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[0m","\u001b[0;32m<ipython-input-43-c19804cd546f>\u001b[0m in \u001b[0;36mload_pdf\u001b[0;34m()\u001b[0m\n\u001b[1;32m      2\u001b[0m \u001b[0;34m\u001b[0m\u001b[0m\n\u001b[1;32m      3\u001b[0m \u001b[0;32mdef\u001b[0m \u001b[0mload_pdf\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m:\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[0;32m----> 4\u001b[0;31m     \u001b[0;32mreturn\u001b[0m \u001b[0mPDFMinerLoader\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0mPDF_NAME\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0mload\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[0m\u001b[1;32m      5\u001b[0m   \u001b[0;31m#return PyMuPDFLoader(PDF_NAME).load()\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n","\u001b[0;31mNameError\u001b[0m: name 'PDFMinerLoader' is not defined"]}]},{"cell_type":"code","source":["f = open(\"/content/drive/MyDrive/news.txt\", 'r')\n","docs = f.readlines()\n","f.close()"],"metadata":{"id":"vPf6RkZc8u6F","executionInfo":{"status":"ok","timestamp":1703742496721,"user_tz":-540,"elapsed":329,"user":{"displayName":"김규미","userId":"17000887428504010317"}}},"execution_count":78,"outputs":[]},{"cell_type":"code","source":["docs"],"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"f74l3KHj04DO","executionInfo":{"status":"ok","timestamp":1703742501874,"user_tz":-540,"elapsed":361,"user":{"displayName":"김규미","userId":"17000887428504010317"}},"outputId":"9f71dc71-b6bb-499e-f3a2-9f1ce3bdb461"},"execution_count":79,"outputs":[{"output_type":"execute_result","data":{"text/plain":["['삼성전자 파운드리사업부 최고기술책임자(CTO) 자리에 또다시 변화가 생겼다. 지난 7월 선임된 CTO가 물러난 것으로 확인됐다.\\n',\n"," '\\n',\n"," '28일 업계에 따르면 삼성전자 파운드리사업부 CTO를 맡던 부사장급 임원이 지난달 말 정기 인사에서 보좌역으로 전환됐다.\\n',\n"," '\\n',\n"," '보좌역은 경영진 대상으로 사업을 자문하거나 지원하는 보직이다. CTO로 선임된 지 약 5개월 만에 생긴 이례적 변화다. 1년에 CTO가 두 번이나 바뀌게 됐다.\\n',\n"," '\\n',\n"," '후임 CTO는 아직 결정되지 않았다. 삼성 연말 인사가 있은 지 한 달이 지났지만 파운드리 CTO는 공석으로 남아 있다. 필요 R&D는 파운드리사업부 내 기술개발 관련 임원들이 팀단위로 이끌고 있는 것으로 전해졌다.']"]},"metadata":{},"execution_count":79}]},{"cell_type":"code","source":["len(docs[0].page_content)\n","#len(docs[0])"],"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"TNjBnHqb02uI","executionInfo":{"status":"ok","timestamp":1703745642647,"user_tz":-540,"elapsed":301,"user":{"displayName":"김규미","userId":"17000887428504010317"}},"outputId":"db8669c9-b045-4615-b96a-38a7c33ae375"},"execution_count":102,"outputs":[{"output_type":"execute_result","data":{"text/plain":["640"]},"metadata":{},"execution_count":102}]},{"cell_type":"code","execution_count":103,"metadata":{"id":"33zAThYjY9gA","colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"status":"ok","timestamp":1703745671211,"user_tz":-540,"elapsed":302,"user":{"displayName":"김규미","userId":"17000887428504010317"}},"outputId":"4df2035d-fe55-441a-ad51-70628ac2d451"},"outputs":[{"output_type":"stream","name":"stdout","text":["You have 11 document(s) in your data\n","There are 640 characters in the first page of your document\n","There are 7876 characters in your document\n"]}],"source":["print (f'You have {len(docs)} document(s) in your data')\n","print (f'There are {len(docs[0].page_content)} characters in the first page of your document')\n","\n","total = 0\n","for doc in docs:\n","  total += len(doc.page_content)\n","print (f'There are {total} characters in your document')"]},{"cell_type":"code","execution_count":121,"metadata":{"id":"ziV20FzmZpm1","executionInfo":{"status":"ok","timestamp":1703745904904,"user_tz":-540,"elapsed":334,"user":{"displayName":"김규미","userId":"17000887428504010317"}}},"outputs":[],"source":["from langchain.text_splitter import RecursiveCharacterTextSplitter\n","\n","text_splitter = RecursiveCharacterTextSplitter(chunk_size=200, chunk_overlap=0)\n","split_docs = text_splitter.split_documents(docs)"]},{"cell_type":"code","execution_count":122,"metadata":{"id":"WlDqqN_6Z08T","colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"status":"ok","timestamp":1703745905870,"user_tz":-540,"elapsed":4,"user":{"displayName":"김규미","userId":"17000887428504010317"}},"outputId":"ccb0e733-275a-402d-a22b-36be5c1981f8"},"outputs":[{"output_type":"stream","name":"stdout","text":["Now you have 48 documents\n"]}],"source":["print (f'Now you have {len(split_docs)} documents')\n","#print (f'Now you have {len(docs)} documents')"]},{"cell_type":"code","execution_count":123,"metadata":{"id":"6IOlsXpbaIAw","executionInfo":{"status":"ok","timestamp":1703745908079,"user_tz":-540,"elapsed":1188,"user":{"displayName":"김규미","userId":"17000887428504010317"}}},"outputs":[],"source":["from langchain.embeddings.openai import OpenAIEmbeddings\n","from langchain.vectorstores import Chroma\n","import os\n","from google.colab import userdata\n","os.environ[\"OPENAI_API_KEY\"] = userdata.get('HOME')\n","OPENAI_API_KEY = os.environ[\"OPENAI_API_KEY\"]"]},{"cell_type":"code","execution_count":124,"metadata":{"id":"bE-KtYTCgkLw","executionInfo":{"status":"ok","timestamp":1703745909964,"user_tz":-540,"elapsed":513,"user":{"displayName":"김규미","userId":"17000887428504010317"}}},"outputs":[],"source":["embeddings = OpenAIEmbeddings(openai_api_key=OPENAI_API_KEY)"]},{"cell_type":"code","execution_count":125,"metadata":{"id":"hGdpt9LygkLy","executionInfo":{"status":"ok","timestamp":1703745912947,"user_tz":-540,"elapsed":322,"user":{"displayName":"김규미","userId":"17000887428504010317"}}},"outputs":[],"source":["# persist_directory = 'starknet'\n","# collection_name = 'starknet_index'\n","persist_directory = 'novel'\n","collection_name = 'novel_index'"]},{"cell_type":"code","execution_count":126,"metadata":{"id":"OUJNJJhU5EsN","executionInfo":{"status":"ok","timestamp":1703745913838,"user_tz":-540,"elapsed":4,"user":{"displayName":"김규미","userId":"17000887428504010317"}}},"outputs":[],"source":["from langchain.callbacks import get_openai_callback"]},{"cell_type":"code","execution_count":127,"metadata":{"id":"1mQJJ8HRaf0I","colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"status":"ok","timestamp":1703745916274,"user_tz":-540,"elapsed":1459,"user":{"displayName":"김규미","userId":"17000887428504010317"}},"outputId":"8f94f41d-9de1-44fc-da9e-962def1ba0db"},"outputs":[{"output_type":"stream","name":"stdout","text":["Tokens Used: 0\n","\tPrompt Tokens: 0\n","\tCompletion Tokens: 0\n","Successful Requests: 0\n","Total Cost (USD): $0.0\n"]}],"source":["with get_openai_callback() as cb:\n","    vectorstore = Chroma.from_documents(split_docs, embeddings, collection_name=collection_name, persist_directory=persist_directory)\n","    #vectorstore = Chroma.from_texts(docs, embeddings, collection_name=collection_name, persist_directory=persist_directory)\n","    vectorstore.persist()\n","    print(cb)\n"]},{"cell_type":"code","execution_count":128,"metadata":{"id":"yBAx1_X-beQp","executionInfo":{"status":"ok","timestamp":1703745917813,"user_tz":-540,"elapsed":308,"user":{"displayName":"김규미","userId":"17000887428504010317"}}},"outputs":[],"source":["from langchain.llms import OpenAI\n","from langchain.chains.question_answering import load_qa_chain"]},{"cell_type":"code","execution_count":129,"metadata":{"id":"V8hds-zybhfc","colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"status":"ok","timestamp":1703745918588,"user_tz":-540,"elapsed":334,"user":{"displayName":"김규미","userId":"17000887428504010317"}},"outputId":"e4c409ad-8e70-4e42-f7b0-260b72b81b42"},"outputs":[{"output_type":"execute_result","data":{"text/plain":["[Document(page_content='지에 대한 기억들，마음속 사소한 궁금증을 터놓을 데가 없었다 \\n이제는 영도와 부산 밖의 세상이 어떻게 돌아가는지 물어볼 사람 \\n이 생겼다 한수는 선자가 하루를 어떻게 보냈는지 듣고 싶어 했 \\n다 선자의 꿈이 무엇인지까지 알고 싶어 했다 가끔 선자가 난처 \\n한 일을 처리하거나 사람을 상대하는 법을 모를 때면 해결책을 \\n알려주었다 늘 한수는 문제를 해결할 묘안을 생각해냈다 두 사 \\n람은 선자의 어머니 이야기는 절대 하지 않았다.\\n장에서 일하고 있는 한수를 보면 낯설었다 선자와 함께 있을 \\n때의 한수와는 다른 사람 같았다 한수는 선자의 친구이자 오빠 \\n71', metadata={'page': 8, 'source': '/content/drive/MyDrive/63_73_OCR_compressed.pdf'}),\n"," Document(page_content='점 편해졌다 가을이 오자 바닷바람이 상쾌하고 쌀쌀해졌지만 선 \\n자는 추운 줄도 몰랐다\\n9월 초에 닷새 내내 비가 왔다 마침내 비가 개자 양진이 선자 \\n에게 다음 날 아침에 태종대 숲에 가서 버섯을 따 오라고 시켰다 \\n선자는 버섯 따는 것을 좋아했고，마침 바닷가에서 한수를 만날 \\n참이라 맨날 하는 일이 아닌 색다른 일을 하러 간다고 말할 생각', metadata={'page': 9, 'source': '/content/drive/MyDrive/63_73_OCR_compressed.pdf'}),\n"," Document(page_content='었고 이는 선자가 미처 예상하지 못한 일이었다. 한수를 만나기 \\n전에는 자기 생활에 대해 이야기할 사람이 없었다 하숙인들의 우 \\n스운 습관들，어머니 밑에서 일하는 자매들과 나눈 대화들，아버 \\n지에 대한 기억들，마음속 사소한 궁금증을 터놓을 데가 없었다 \\n이제는 영도와 부산 밖의 세상이 어떻게 돌아가는지 물어볼 사람', metadata={'page': 8, 'source': '/content/drive/MyDrive/63_73_OCR_compressed.pdf'}),\n"," Document(page_content='이 생겼다 한수는 선자가 하루를 어떻게 보냈는지 듣고 싶어 했 \\n다 선자의 꿈이 무엇인지까지 알고 싶어 했다 가끔 선자가 난처 \\n한 일을 처리하거나 사람을 상대하는 법을 모를 때면 해결책을 \\n알려주었다 늘 한수는 문제를 해결할 묘안을 생각해냈다 두 사 \\n람은 선자의 어머니 이야기는 절대 하지 않았다.', metadata={'page': 8, 'source': '/content/drive/MyDrive/63_73_OCR_compressed.pdf'})]"]},"metadata":{},"execution_count":129}],"source":["llm = OpenAI(temperature=0, openai_api_key=OPENAI_API_KEY)\n","\n","chain = load_qa_chain(llm, chain_type=\"stuff\")\n","\n","# Load the vectorstore from disk\n","vectordb = Chroma(collection_name=collection_name, persist_directory=persist_directory, embedding_function=embeddings)\n","\n","query = \"장날에 무슨일이 일어났나요?\"\n","#docs = vectorstore.similarity_search(query, 3, include_metadata=True)\n","retriever = vectorstore.as_retriever()\n","retriever.get_relevant_documents(query)"]},{"cell_type":"code","source":["query = \"후임 CTO가 결정되었나?\"\n","retriever.get_relevant_documents(query)"],"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"lQ0gcRfR_AXV","executionInfo":{"status":"ok","timestamp":1703742824198,"user_tz":-540,"elapsed":770,"user":{"displayName":"김규미","userId":"17000887428504010317"}},"outputId":"c0d1211e-fbd8-47f3-f90d-00d805777832"},"execution_count":98,"outputs":[{"output_type":"execute_result","data":{"text/plain":["[Document(page_content='후임 CTO는 아직 결정되지 않았다. 삼성 연말 인사가 있은 지 한 달이 지났지만 파운드리 CTO는 공석으로 남아 있다. 필요 R&D는 파운드리사업부 내 기술개발 관련 임원들이 팀단위로 이끌고 있는 것으로 전해졌다.'),\n"," Document(page_content='보좌역은 경영진 대상으로 사업을 자문하거나 지원하는 보직이다. CTO로 선임된 지 약 5개월 만에 생긴 이례적 변화다. 1년에 CTO가 두 번이나 바뀌게 됐다.\\n'),\n"," Document(page_content='삼성전자 파운드리사업부 최고기술책임자(CTO) 자리에 또다시 변화가 생겼다. 지난 7월 선임된 CTO가 물러난 것으로 확인됐다.\\n'),\n"," Document(page_content='28일 업계에 따르면 삼성전자 파운드리사업부 CTO를 맡던 부사장급 임원이 지난달 말 정기 인사에서 보좌역으로 전환됐다.\\n')]"]},"metadata":{},"execution_count":98}]},{"cell_type":"code","execution_count":130,"metadata":{"id":"zcuCDZjO5EsN","colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"status":"ok","timestamp":1703745925518,"user_tz":-540,"elapsed":311,"user":{"displayName":"김규미","userId":"17000887428504010317"}},"outputId":"5e002c55-3e3b-4141-b053-4d9976101ce1"},"outputs":[{"output_type":"stream","name":"stdout","text":["input_variables=['page_content'] template='{page_content}'\n"]}],"source":["print(chain.document_prompt)"]},{"cell_type":"code","execution_count":131,"metadata":{"id":"K3SlreQ2haC4","colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"status":"ok","timestamp":1703745927703,"user_tz":-540,"elapsed":305,"user":{"displayName":"김규미","userId":"17000887428504010317"}},"outputId":"63ae3ab2-be47-4207-ca54-6633a211694e"},"outputs":[{"output_type":"stream","name":"stdout","text":["{'source': '/content/drive/MyDrive/63_73_OCR_compressed.pdf', 'page': 0}\n","{'source': '/content/drive/MyDrive/63_73_OCR_compressed.pdf', 'page': 1}\n","{'source': '/content/drive/MyDrive/63_73_OCR_compressed.pdf', 'page': 2}\n","{'source': '/content/drive/MyDrive/63_73_OCR_compressed.pdf', 'page': 3}\n","{'source': '/content/drive/MyDrive/63_73_OCR_compressed.pdf', 'page': 4}\n","{'source': '/content/drive/MyDrive/63_73_OCR_compressed.pdf', 'page': 5}\n","{'source': '/content/drive/MyDrive/63_73_OCR_compressed.pdf', 'page': 6}\n","{'source': '/content/drive/MyDrive/63_73_OCR_compressed.pdf', 'page': 7}\n","{'source': '/content/drive/MyDrive/63_73_OCR_compressed.pdf', 'page': 8}\n","{'source': '/content/drive/MyDrive/63_73_OCR_compressed.pdf', 'page': 9}\n","{'source': '/content/drive/MyDrive/63_73_OCR_compressed.pdf', 'page': 10}\n"]}],"source":["for doc in docs:\n","    print(doc.metadata)"]},{"cell_type":"code","execution_count":132,"metadata":{"id":"HCTlNs7l5EsN","colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"status":"ok","timestamp":1703745930867,"user_tz":-540,"elapsed":338,"user":{"displayName":"김규미","userId":"17000887428504010317"}},"outputId":"557b5366-6913-4514-aab0-2bb392c68263"},"outputs":[{"output_type":"stream","name":"stdout","text":["8021\n"]}],"source":["print(chain.prompt_length(docs, question='What is starknet?'))"]},{"cell_type":"code","execution_count":140,"metadata":{"id":"zdF03LqphOQY","colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"status":"ok","timestamp":1703746624924,"user_tz":-540,"elapsed":819,"user":{"displayName":"김규미","userId":"17000887428504010317"}},"outputId":"88d6a0d7-318f-49b8-e449-18003b547ee3"},"outputs":[{"output_type":"stream","name":"stdout","text":[" 네, 한수와 선자는 둘 다 섬 출신입니다.\n","Tokens Used: 1770\n","\tPrompt Tokens: 1749\n","\tCompletion Tokens: 21\n","Successful Requests: 1\n","Total Cost (USD): $0.0026655000000000003\n"]}],"source":["query = \"한수랑 선자는 둘 다 섬 출신인가요? 한국어로 대답해줘요.\"\n","\n","with get_openai_callback() as cb:\n","    print(chain.run(input_documents=split_docs[:10], question=query))\n","    print(cb)"]},{"cell_type":"markdown","metadata":{"id":"O-J0vk0j5EsN"},"source":[]}],"metadata":{"colab":{"provenance":[{"file_id":"https://github.com/sugarforever/LangChain-Tutorials/blob/main/LangChain_PDF_Chatbot.ipynb","timestamp":1703724676603}]},"kernelspec":{"display_name":"Python 3","name":"python3"},"language_info":{"codemirror_mode":{"name":"ipython","version":3},"file_extension":".py","mimetype":"text/x-python","name":"python","nbconvert_exporter":"python","pygments_lexer":"ipython3","version":"3.9.16"}},"nbformat":4,"nbformat_minor":0}